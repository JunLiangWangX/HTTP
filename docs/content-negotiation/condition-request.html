<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>条件请求 | HTTP完全注释</title>
    <meta name="description" content="条件请求是HTTP的一种内容协商机制，该机制通过在请求中包含特定的标头来告知服务器仅在某些条件得到满足时才响应。这类请求可以用来验证缓存的有效性，省去不必要的控制手段，帮助减少不必要的数据传输，提高效率，验证文件的完整性，确保资源的一致性和完整性。">
    <meta name="generator" content="VitePress v1.0.0-rc.44">
    <link rel="preload stylesheet" href="/HTTP-Explanation/assets/style.CooNPIGV.css" as="style">
    
    <script type="module" src="/HTTP-Explanation/assets/app.CDUMPHOE.js"></script>
    <link rel="preload" href="/HTTP-Explanation/assets/inter-roman-latin.Bu8hRsVA.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/HTTP-Explanation/assets/chunks/framework.EWeOaUEN.js">
    <link rel="modulepreload" href="/HTTP-Explanation/assets/chunks/theme.D27t3RVL.js">
    <link rel="modulepreload" href="/HTTP-Explanation/assets/docs_content-negotiation_condition-request.md.oPYlbkb6.lean.js">
    <link rel="icon" href="./logo.svg">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7298585637298195" crossorigin="anonymous"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-X83T8C1XEL"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-X83T8C1XEL");</script>
    <script>var _hmt=_hmt||[];(function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?92e568bf422499874640dbee88096c2d";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)})();</script>
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
    <meta name="keywords" content="HTTP 条件请求 验证缓存的有效性 If-Unmodified-Since Last-Modified If-Modified-Since If-None-Match If-Match ETag If-Match If-Range">
    <link rel="manifest" href="/HTTP-Explanation/manifest.webmanifest">
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-5d98c3a5><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0f60ec36></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0f60ec36> Skip to content </a><!--]--><!----><header class="VPNav" data-v-5d98c3a5 data-v-ae24b3ad><div class="VPNavBar has-sidebar" data-v-ae24b3ad data-v-19c990f1><div class="wrapper" data-v-19c990f1><div class="container" data-v-19c990f1><div class="title" data-v-19c990f1><div class="VPNavBarTitle has-sidebar" data-v-19c990f1 data-v-ab179fa1><a class="title" href="/HTTP-Explanation/" data-v-ab179fa1><!--[--><!--]--><!----><span data-v-ab179fa1>HTTP完全注释</span><!--[--><!--]--></a></div></div><div class="content" data-v-19c990f1><div class="content-body" data-v-19c990f1><!--[--><!--]--><div class="VPNavBarSearch search" data-v-19c990f1><!----><div id="docsearch"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><span class="DocSearch-Button-Key">Meta</span><span class="DocSearch-Button-Key">K</span></span></button></div></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-19c990f1 data-v-7f418b0f><span id="main-nav-aria-label" class="visually-hidden" data-v-7f418b0f>Main Navigation</span><!--[--><!--[--><a class="VPLink link vp-external-link-icon VPNavBarMenuLink" href="https://wangjunliang.com/#/supportBloggers" target="_blank" rel="noreferrer" tabindex="0" data-v-7f418b0f data-v-42ef59de><!--[--><span data-v-42ef59de>支持作者</span><!--]--></a><!--]--><!--[--><a class="VPLink link vp-external-link-icon VPNavBarMenuLink" href="https://wangjunliang.com/" target="_blank" rel="noreferrer" tabindex="0" data-v-7f418b0f data-v-42ef59de><!--[--><span data-v-42ef59de>了解作者</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-19c990f1 data-v-e6aabb21><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-e6aabb21 data-v-d1f28634 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-d1f28634></span><span class="vpi-moon moon" data-v-d1f28634></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-19c990f1 data-v-0394ad82 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/JunLiangWangX/HTTP-Explanation/" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-eee4e7cb><span class="vpi-social-github" /></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-19c990f1 data-v-d0bd9dde data-v-b6c34ac9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-b6c34ac9><span class="vpi-more-horizontal icon" data-v-b6c34ac9></span></button><div class="menu" data-v-b6c34ac9><div class="VPMenu" data-v-b6c34ac9 data-v-e7ea1737><!----><!--[--><!--[--><!----><div class="group" data-v-d0bd9dde><div class="item appearance" data-v-d0bd9dde><p class="label" data-v-d0bd9dde>切换模式</p><div class="appearance-action" data-v-d0bd9dde><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-d0bd9dde data-v-d1f28634 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-d1f28634></span><span class="vpi-moon moon" data-v-d1f28634></span><!--]--></span></span></button></div></div></div><div class="group" data-v-d0bd9dde><div class="item social-links" data-v-d0bd9dde><div class="VPSocialLinks social-links-list" data-v-d0bd9dde data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/JunLiangWangX/HTTP-Explanation/" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-eee4e7cb><span class="vpi-social-github" /></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-19c990f1 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-19c990f1><div class="divider-line" data-v-19c990f1></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-5d98c3a5 data-v-a6f0e41e><div class="container" data-v-a6f0e41e><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-a6f0e41e><span class="vpi-align-left menu-icon" data-v-a6f0e41e></span><span class="menu-text" data-v-a6f0e41e>菜单</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-a6f0e41e data-v-d2ecc192><button data-v-d2ecc192>返回顶部</button><!----></div></div></div><aside class="VPSidebar" data-v-5d98c3a5 data-v-575e6a36><div class="curtain" data-v-575e6a36></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-575e6a36><span class="visually-hidden" id="sidebar-aria-label" data-v-575e6a36> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-575e6a36><section class="VPSidebarItem level-0" data-v-575e6a36 data-v-93e7e794><div class="item" role="button" tabindex="0" data-v-93e7e794><div class="indicator" data-v-93e7e794></div><h2 class="text" data-v-93e7e794>前言</h2><!----></div><div class="items" data-v-93e7e794><!--[--><div class="VPSidebarItem level-1 is-link" data-v-93e7e794 data-v-93e7e794><div class="item" data-v-93e7e794><div class="indicator" data-v-93e7e794></div><a class="VPLink link link" href="/HTTP-Explanation/docs/introduc/introduc.html" data-v-93e7e794><!--[--><p class="text" data-v-93e7e794>这是一份最强HTTP指南</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-575e6a36><section class="VPSidebarItem level-0" data-v-575e6a36 data-v-93e7e794><div class="item" role="button" tabindex="0" data-v-93e7e794><div class="indicator" data-v-93e7e794></div><h2 class="text" data-v-93e7e794>概述</h2><!----></div><div class="items" data-v-93e7e794><!--[--><div class="VPSidebarItem level-1 is-link" data-v-93e7e794 data-v-93e7e794><div class="item" data-v-93e7e794><div class="indicator" data-v-93e7e794></div><a class="VPLink link link" href="/HTTP-Explanation/docs/overview/the-history-of-http.html" data-v-93e7e794><!--[--><p class="text" data-v-93e7e794>HTTP的历史</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-93e7e794 data-v-93e7e794><div class="item" data-v-93e7e794><div class="indicator" data-v-93e7e794></div><a class="VPLink link link" href="/HTTP-Explanation/docs/overview/http-message-format.html" data-v-93e7e794><!--[--><p class="text" data-v-93e7e794>HTTP的报文格式</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-575e6a36><section class="VPSidebarItem level-0" data-v-575e6a36 data-v-93e7e794><div class="item" role="button" tabindex="0" data-v-93e7e794><div class="indicator" data-v-93e7e794></div><h2 class="text" data-v-93e7e794>安全策略</h2><!----></div><div class="items" data-v-93e7e794><!--[--><div class="VPSidebarItem level-1 is-link" data-v-93e7e794 data-v-93e7e794><div class="item" data-v-93e7e794><div class="indicator" data-v-93e7e794></div><a class="VPLink link link" href="/HTTP-Explanation/docs/security-strategy/rescue-insecure-http-https.html" data-v-93e7e794><!--[--><p class="text" data-v-93e7e794>拯救不安全的HTTP - HTTPS</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-93e7e794 data-v-93e7e794><div class="item" data-v-93e7e794><div class="indicator" data-v-93e7e794></div><a class="VPLink link link" href="/HTTP-Explanation/docs/security-strategy/content-security-policy.html" data-v-93e7e794><!--[--><p class="text" data-v-93e7e794>XSS攻击？内容安全策略会出手的</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-93e7e794 data-v-93e7e794><div class="item" data-v-93e7e794><div class="indicator" data-v-93e7e794></div><a class="VPLink link link" href="/HTTP-Explanation/docs/security-strategy/same-origin-policy.html" data-v-93e7e794><!--[--><p class="text" data-v-93e7e794>CSRF攻击？同源策略会出手的</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-93e7e794 data-v-93e7e794><div class="item" data-v-93e7e794><div class="indicator" data-v-93e7e794></div><a class="VPLink link link" href="/HTTP-Explanation/docs/security-strategy/cross-origin-resource-sharing.html" data-v-93e7e794><!--[--><p class="text" data-v-93e7e794>又跨域了？一文解释清楚跨源资源共享（cors）</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-93e7e794 data-v-93e7e794><div class="item" data-v-93e7e794><div class="indicator" data-v-93e7e794></div><a class="VPLink link link" href="/HTTP-Explanation/docs/security-strategy/common-attack-and-protection-methods.html" data-v-93e7e794><!--[--><p class="text" data-v-93e7e794>常见攻击与防护</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-575e6a36><section class="VPSidebarItem level-0" data-v-575e6a36 data-v-93e7e794><div class="item" role="button" tabindex="0" data-v-93e7e794><div class="indicator" data-v-93e7e794></div><h2 class="text" data-v-93e7e794>身份认证策略</h2><!----></div><div class="items" data-v-93e7e794><!--[--><div class="VPSidebarItem level-1 is-link" data-v-93e7e794 data-v-93e7e794><div class="item" data-v-93e7e794><div class="indicator" data-v-93e7e794></div><a class="VPLink link link" href="/HTTP-Explanation/docs/authentication-strategy/cookie.html" data-v-93e7e794><!--[--><p class="text" data-v-93e7e794>Cookie</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-93e7e794 data-v-93e7e794><div class="item" data-v-93e7e794><div class="indicator" data-v-93e7e794></div><a class="VPLink link link" href="/HTTP-Explanation/docs/authentication-strategy/authorization.html" data-v-93e7e794><!--[--><p class="text" data-v-93e7e794>Authorization</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-575e6a36><section class="VPSidebarItem level-0" data-v-575e6a36 data-v-93e7e794><div class="item" role="button" tabindex="0" data-v-93e7e794><div class="indicator" data-v-93e7e794></div><h2 class="text" data-v-93e7e794>性能优化策略</h2><!----></div><div class="items" data-v-93e7e794><!--[--><div class="VPSidebarItem level-1 is-link" data-v-93e7e794 data-v-93e7e794><div class="item" data-v-93e7e794><div class="indicator" data-v-93e7e794></div><a class="VPLink link link" href="/HTTP-Explanation/docs/performance-optimization-strategy/long-connection-and-short-connection.html" data-v-93e7e794><!--[--><p class="text" data-v-93e7e794>长连接与短连接</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-93e7e794 data-v-93e7e794><div class="item" data-v-93e7e794><div class="indicator" data-v-93e7e794></div><a class="VPLink link link" href="/HTTP-Explanation/docs/performance-optimization-strategy/http-cache.html" data-v-93e7e794><!--[--><p class="text" data-v-93e7e794>HTTP缓存</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-93e7e794 data-v-93e7e794><div class="item" data-v-93e7e794><div class="indicator" data-v-93e7e794></div><a class="VPLink link link" href="/HTTP-Explanation/docs/performance-optimization-strategy/data-compression.html" data-v-93e7e794><!--[--><p class="text" data-v-93e7e794>数据压缩</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-575e6a36><section class="VPSidebarItem level-0 has-active" data-v-575e6a36 data-v-93e7e794><div class="item" role="button" tabindex="0" data-v-93e7e794><div class="indicator" data-v-93e7e794></div><h2 class="text" data-v-93e7e794>内容协商策略</h2><!----></div><div class="items" data-v-93e7e794><!--[--><div class="VPSidebarItem level-1 is-link" data-v-93e7e794 data-v-93e7e794><div class="item" data-v-93e7e794><div class="indicator" data-v-93e7e794></div><a class="VPLink link link" href="/HTTP-Explanation/docs/content-negotiation/range-request.html" data-v-93e7e794><!--[--><p class="text" data-v-93e7e794>范围请求</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-93e7e794 data-v-93e7e794><div class="item" data-v-93e7e794><div class="indicator" data-v-93e7e794></div><a class="VPLink link link" href="/HTTP-Explanation/docs/content-negotiation/condition-request.html" data-v-93e7e794><!--[--><p class="text" data-v-93e7e794>条件请求</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-93e7e794 data-v-93e7e794><div class="item" data-v-93e7e794><div class="indicator" data-v-93e7e794></div><a class="VPLink link link" href="/HTTP-Explanation/docs/content-negotiation/content-negotiation.html" data-v-93e7e794><!--[--><p class="text" data-v-93e7e794>内容协商</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-93e7e794 data-v-93e7e794><div class="item" data-v-93e7e794><div class="indicator" data-v-93e7e794></div><a class="VPLink link link" href="/HTTP-Explanation/docs/content-negotiation/client-hints.html" data-v-93e7e794><!--[--><p class="text" data-v-93e7e794>客户端提示</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-575e6a36><section class="VPSidebarItem level-0" data-v-575e6a36 data-v-93e7e794><div class="item" role="button" tabindex="0" data-v-93e7e794><div class="indicator" data-v-93e7e794></div><h2 class="text" data-v-93e7e794>其他</h2><!----></div><div class="items" data-v-93e7e794><!--[--><div class="VPSidebarItem level-1 is-link" data-v-93e7e794 data-v-93e7e794><div class="item" data-v-93e7e794><div class="indicator" data-v-93e7e794></div><a class="VPLink link link" href="/HTTP-Explanation/docs/other/mime-type.html" data-v-93e7e794><!--[--><p class="text" data-v-93e7e794>MIME类型</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-93e7e794 data-v-93e7e794><div class="item" data-v-93e7e794><div class="indicator" data-v-93e7e794></div><a class="VPLink link link" href="/HTTP-Explanation/docs/other/url.html" data-v-93e7e794><!--[--><p class="text" data-v-93e7e794>URL</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-5d98c3a5 data-v-1428d186><div class="VPDoc has-sidebar has-aside" data-v-1428d186 data-v-39a288b8><!--[--><!--]--><div class="container" data-v-39a288b8><div class="aside" data-v-39a288b8><div class="aside-curtain" data-v-39a288b8></div><div class="aside-container" data-v-39a288b8><div class="aside-content" data-v-39a288b8><div class="VPDocAside" data-v-39a288b8 data-v-3f215769><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" role="navigation" data-v-3f215769 data-v-935f8a84><div class="content" data-v-935f8a84><div class="outline-marker" data-v-935f8a84></div><div class="outline-title" role="heading" aria-level="2" data-v-935f8a84>目录</div><nav aria-labelledby="doc-outline-aria-label" data-v-935f8a84><span class="visually-hidden" id="doc-outline-aria-label" data-v-935f8a84> Table of Contents for current page </span><ul class="VPDocOutlineItem root" data-v-935f8a84 data-v-b933a997><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-39a288b8><div class="content-container" data-v-39a288b8><!--[--><!--]--><main class="main" data-v-39a288b8><div style="position:relative;" class="vp-doc _HTTP-Explanation_docs_content-negotiation_condition-request" data-v-39a288b8><div><h1 id="条件请求" tabindex="-1">条件请求 <a class="header-anchor" href="#条件请求" aria-label="Permalink to &quot;条件请求&quot;">​</a></h1><p>还记得范围请求以及缓存中所介绍的基于时间/版本的验证请求吗？这些能够携带某些条件发起的请求，被称为条件请求。<strong>条件请求是HTTP的一种内容协商机制，该机制通过在请求中包含特定的标头来告知服务器仅在某些条件得到满足时才响应</strong>。这类请求可以用来验证缓存的有效性，省去不必要的控制手段，帮助减少不必要的数据传输，提高效率，验证文件的完整性，确保资源的一致性和完整性。</p><h2 id="条件请求的分类" tabindex="-1">条件请求的分类 <a class="header-anchor" href="#条件请求的分类" aria-label="Permalink to &quot;条件请求的分类&quot;">​</a></h2><p><strong>条件请求正如缓存与范围请求中介绍的那样，分为了基于时间的条件请求与基于版本的条件请求</strong>。</p><h3 id="基于时间的条件请求" tabindex="-1">基于时间的条件请求 <a class="header-anchor" href="#基于时间的条件请求" aria-label="Permalink to &quot;基于时间的条件请求&quot;">​</a></h3><p>基于时间的条件请求依赖<code>Last-Modified</code>响应标头表明资源最后修改时间，依赖<code>If-Modified-Since</code>(缓存、普通请求使用)、<code>If-Unmodified-Since</code>(普通请求使用)或<code>If-Range</code>(范围请求使用)请求标头携带已请求过的资源的最后修改时间，以供服务器检查两资源修改时间是否一致，以此判断资源是否修改。<code>If-Modified-Since</code>是指当资源发生了修改则满足条件，提供资源；而<code>If-Unmodified-Since</code>与<code>If-Range</code>则是指当资源未发生修改则满足条件，提供资源。</p><p><img src="/HTTP-Explanation/assets/date-condition-request.C1CaM0Xb.png" alt="date-condition-request"></p><p>基于时间的条件请求工作流程：</p><ul><li><p><strong>客户端请求资源</strong></p></li><li><p><strong>服务端响应资源：</strong> 服务端响应客户端请求资源，并携带<code>Last-Modified</code>响应标头表明所请求的资源最后修改时间。</p></li><li><p><strong>客户端发起条件请求：</strong> 客户端根据不同的请求使用相关标头携带之前请求过的资源的最后修改时间，对同一资源发起条件请求。</p><div class="tip custom-block"><p class="custom-block-title">不同的请求发起条件请求所使用的标头</p><ul><li><code>If-Modified-Since</code>:缓存、普通请求使用</li><li><code>If-Unmodified-Since</code>:普通请求使用</li><li><code>If-Range</code>:范围请求使用</li></ul></div></li><li><p><strong>服务端判断并响应资源：</strong> 根据请求携带的修改时间，检查服务器当前资源的修改时间是否一致，以此判断资源是否修改。最后根据不同的标头响应资源。</p><div class="tip custom-block"><p class="custom-block-title">不同标头响应资源的情况</p><ul><li><code>If-Modified-Since</code>:资源发生修改则响应资源返回<code>200</code>状态码，未发生修改则只响应状态码<code>304 Not Modified</code></li><li><code>If-Unmodified-Since</code>:资源未发生修改则响应资源返回<code>200</code>状态码，已发生修改则只响应状态码<code>412 Precondition Failed</code></li><li><code>If-Range</code>:资源未发生修改则响应部分资源并返回<code>206 Partial Content</code>状态码，资源发生修改则响应资源全部内容并返回<code>200</code>状态码</li></ul></div></li></ul><p>基于时间的条件请求虽然避免了重新传输相同的资源的问题，但它也存在诸多问题：</p><ul><li><strong>时钟同步问题：</strong> 基于时间的条件请求的前提条件是服务器和客户端的时钟是同步的。如果两者的时钟存在差异，可能会导致验证失败。这种情况下，服务器认为资源已经过期，但实际上客户端的时钟比服务器快或慢，导致了不必要的资源传输。</li><li><strong>时间精度问题：</strong> 时间戳通常只有秒级别的精度，这可能导致在某些情况下无法检测到资源的真正修改。如果两次修改之间的时间间隔很短，可能无法捕捉到变化。</li><li><strong>服务器时钟回退：</strong> 如果服务器的时钟回退（例如，由于时钟同步服务的干预），可能会导致客户端认为资源已经过期，尽管实际上它仍然是最新的。</li><li><strong>资源未被修改但最后修改时间已变：</strong> 有时资源的内容并没有实际修改，但由于某些原因，最后修改时间被更新了。这可能导致不必要的资源传输。</li></ul><p>为了解决这些问题，HTTP推出了基于版本的条件请求作为替代方案。</p><h3 id="基于版本的条件请求" tabindex="-1">基于版本的条件请求 <a class="header-anchor" href="#基于版本的条件请求" aria-label="Permalink to &quot;基于版本的条件请求&quot;">​</a></h3><p>基于版本的条件请求依赖<code>ETag</code>响应标头表明资源的版本，依赖<code>If-None-Match</code>(缓存、普通请求使用)、<code>If-Match</code>(普通请求使用)或<code>If-Range</code>(范围请求使用)请求标头携带已请求过的资源的版本，以供服务器检查两资源版本是否一致，以此判断资源是否修改。<code>If-None-Match</code>是指当资源发生了修改则满足条件，提供资源；而<code>If-Match</code>与<code>If-Range</code>则是指当资源未发生修改则满足条件，提供资源。</p><p><img src="/HTTP-Explanation/assets/version-condition-request.icM_8ySp.png" alt="version-condition-request"></p><p>基于版本的条件请求工作流程：</p><ul><li><p><strong>客户端请求资源</strong></p></li><li><p><strong>服务端响应资源：</strong> 服务端响应客户端请求资源，并携带<code>ETag</code>响应标头表明所请求的资源的版本。</p></li><li><p><strong>客户端发起条件请求：</strong> 客户端根据不同的请求使用相关标头携带之前请求过的资源的版本，对同一资源发起条件请求。</p><div class="tip custom-block"><p class="custom-block-title">不同的请求发起条件请求所使用的标头</p><ul><li><code>If-None-Match</code>:缓存、普通请求使用</li><li><code>If-Match</code>:普通请求使用</li><li><code>If-Range</code>:范围请求使用</li></ul></div></li><li><p><strong>服务端判断并响应资源：</strong> 根据请求携带的资源版本，检查服务器当前资源的版本是否一致，以此判断资源是否修改。最后根据不同的标头响应资源。</p><div class="tip custom-block"><p class="custom-block-title">不同标头响应资源的情况</p><ul><li><code>If-None-Match</code>:资源发生修改则响应资源返回<code>200</code>状态码，未发生修改则只响应状态码<code>304 Not Modified</code></li><li><code>If-Match</code>:资源未发生修改则响应资源返回<code>200</code>状态码，已发生修改则只响应状态码<code>412 Precondition Failed</code></li><li><code>If-Range</code>:资源未发生修改则响应部分资源并返回<code>206 Partial Content</code>状态码，资源发生修改则响应资源全部内容并返回<code>200</code>状态码</li></ul></div></li></ul><p><strong>为什么范围请求要单独规定一个特点的标头<code>If-Range</code>来进行条件请求，而不复用 <code>If-Unmodified-Since</code>和 <code>If-Match</code>呢？</strong></p><p>确实对于范围请求来说，可以使用<code>If-Unmodified-Since</code>和 <code>If-Match</code>来进行条件请求，假如前置条件失败，服务器端会返回错误提示，然后客户端可以从头开始重新下载资源：</p><p><img src="/HTTP-Explanation/assets/httpresume3.DSNs6j9F.png" alt="When the partially downloaded resource has been modified, the preconditions will fail and the resource will have to be downloaded again completely."></p><p>虽然这种方法行得通，但是它在文件发生变化的情况下增加了一次额外的请求/响应往返，这一点会影响性能。为此 HTTP 协议规定了一个特定的标头—— <code>If-Range</code>——来避免这种情况的发生：</p><p><img src="/HTTP-Explanation/assets/httpresume4.aJAw-Nuw.png" alt="The If-Range headers allows the server to directly send back the complete resource if it has been modified, no need to send a 412 error and wait for the client to re-initiate the download."></p><div class="danger custom-block"><p class="custom-block-title">强验证与弱验证</p><p><strong>强验证与弱验证主要用于基于版本的条件请求，是指服务器判断当前资源的版本与请求所指定的版本是否相匹配的验证模式</strong>。强验证模式下，只有当请求给定的版本与服务器当前版本完全一致时，才会判断两资源相同；而弱验证模式下，只要请求给定的版本与服务器当前版本接近，就会判断两资源相同。通过指<code>ETag</code>、<code>If-None-Match</code>、<code>If-Match</code>或<code>If-Range</code>标头的可选的参数<code> W/</code>即可指定为弱验证，而默认不指定则为强验证。</p></div><h2 id="相关标头" tabindex="-1">相关标头 <a class="header-anchor" href="#相关标头" aria-label="Permalink to &quot;相关标头&quot;">​</a></h2><p>标头<code>Last-Modified</code>、<code>If-Modified-Since</code>、<code>ETag</code>、<code>If-None-Match</code>、<code>If-Range</code>已在<a href="https://wangjunliang.com/HTTP-Explanation/docs/performance-optimization-strategy/http-cache.html" target="_blank" rel="noreferrer">HTTP缓存</a>、<a href="https://wangjunliang.com/HTTP-Explanation/docs/content-negotiation/range-request.html" target="_blank" rel="noreferrer">范围请求</a>章节详细介绍过，因此本节不再重复介绍。</p><h3 id="if-unmodified-since-请求标头" tabindex="-1">If-Unmodified-Since <code>请求标头</code> <a class="header-anchor" href="#if-unmodified-since-请求标头" aria-label="Permalink to &quot;If-Unmodified-Since `请求标头`&quot;">​</a></h3><p><strong>请求标头<code>If-Unmodified-Since</code>指定了一个绝对时间，其值为之前已请求过的内容的最后修改时间（通常由响应标头<code>Last-Modified</code>指定），携带该标头希望服务器通过检查当前资源的修改时间与该标头携带时间来判断资源是否发生修改。如果资源未发生修改则响应资源返回<code>200</code>状态码，已发生修改则只响应状态码<code>412 Precondition Failed</code></strong>。</p><p><strong>参数</strong></p><p>该请求标头并无其他参数。</p><p><strong>取值</strong></p><ul><li><p><strong>&lt;date&gt;</strong></p><p>一个绝对时间，其值为之前已请求过的内容的最后修改时间（通常由响应标头<code>Last-Modified</code>指定）</p></li></ul><p><strong>示例</strong></p><div class="language-http vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">http</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">If-Unmodified-Since</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Wed, 21 Oct 2015 07:28:00 GMT</span></span></code></pre></div><h3 id="if-match-请求标头" tabindex="-1">If-Match <code>请求标头</code> <a class="header-anchor" href="#if-match-请求标头" aria-label="Permalink to &quot;If-Match `请求标头`&quot;">​</a></h3><p><strong>请求标头<code>If-Match</code>指定了一个版本号，其值为之前已请求过的内容的版本号（通常由响应标头<code>ETag</code>指定），携带该标头希望服务器通过检查当前资源的版本与该标头携带的版本来判断资源是否发生修改。如果资源未发生修改则响应资源返回<code>200</code>状态码，已发生修改则只响应状态码<code>412 Precondition Failed</code></strong>。</p><p><strong>参数</strong></p><p>该请求标头并无其他参数。</p><p><strong>取值</strong></p><ul><li><p><strong>W/</strong> <code>可选</code></p><p><code>&#39;W/&#39;</code>(大小写敏感) 表示使用<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Conditional_requests#weak_validation" target="_blank" rel="noreferrer">弱验证器</a>。弱验证器很容易生成，但不利于比较。强验证器是比较的理想选择，但很难有效地生成。相同资源的两个弱<code>Etag</code>值可能语义等同，但不是每个字节都相同。</p></li><li><p><strong>&quot;&lt;etag_value&gt;&quot;</strong></p><p>指定一个版本号，表示希望服务器检查资源是否与给定版本号匹配。</p></li><li><p><strong>*</strong> <code>可选</code></p><p>星号是一个特殊值，可以代表任意资源。它只用在进行资源上传时，通常是采用 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Methods/PUT" target="_blank" rel="noreferrer"><code>PUT</code></a> 方法，来检测拥有相同识别 ID 的资源是否已经上传过了。</p></li></ul><p><strong>示例</strong></p><div class="language-http vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">http</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">If-Match</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;bfc13a64729c4290ef5b2c2730249c88ca92d82d&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">If-Match</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> W/&quot;67ab43&quot;, &quot;54ed21&quot;, &quot;7892dd&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">If-Match</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> *</span></span></code></pre></div><h2 id="本节参考" tabindex="-1">本节参考 <a class="header-anchor" href="#本节参考" aria-label="Permalink to &quot;本节参考&quot;">​</a></h2><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Conditional_requests" target="_blank" rel="noreferrer">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Conditional_requests</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/If-Unmodified-Since" target="_blank" rel="noreferrer">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/If-Unmodified-Since</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/If-Match" target="_blank" rel="noreferrer">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/If-Match</a></li></ul><p>转载需要经过本人同意，并标明出处！</p></div></div></main><footer class="VPDocFooter" data-v-39a288b8 data-v-09de1c0f><!--[--><!--]--><div class="edit-info" data-v-09de1c0f><div class="edit-link" data-v-09de1c0f><a class="VPLink link vp-external-link-icon no-icon edit-link-button" href="https://github.com/JunLiangWangX/HTTP-Explanation/edit/main/src/docs/content-negotiation/condition-request.md" target="_blank" rel="noreferrer" data-v-09de1c0f><!--[--><span class="vpi-square-pen edit-link-icon" data-v-09de1c0f></span> 在Github编辑此页<!--]--></a></div><div class="last-updated" data-v-09de1c0f><p class="VPLastUpdated" data-v-09de1c0f data-v-7e05ebdb>最后更新: <time datetime="2024-01-07T07:36:49.000Z" data-v-7e05ebdb></time></p></div></div><nav class="prev-next" data-v-09de1c0f><div class="pager" data-v-09de1c0f><a class="VPLink link pager-link prev" href="/HTTP-Explanation/docs/content-negotiation/range-request.html" data-v-09de1c0f><!--[--><span class="desc" data-v-09de1c0f>上一页</span><span class="title" data-v-09de1c0f>范围请求</span><!--]--></a></div><div class="pager" data-v-09de1c0f><a class="VPLink link pager-link next" href="/HTTP-Explanation/docs/content-negotiation/content-negotiation.html" data-v-09de1c0f><!--[--><span class="desc" data-v-09de1c0f>下一页</span><span class="title" data-v-09de1c0f>内容协商</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-5d98c3a5 data-v-e315a0ad><div class="container" data-v-e315a0ad><p class="message" data-v-e315a0ad>请勿将本站文章用作商业用途 | 转载请标明来源</p><p class="copyright" data-v-e315a0ad>Copyright © 2023-present JunLiangWang</p></div></footer><!--[--><!----><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"docs_authentication-strategy_cookie.md\":\"DKc-2DyF\",\"docs_content-negotiation_range-request.md\":\"CzyF87wG\",\"docs_security-strategy_cross-origin-resource-sharing.md\":\"l7ZyOFqY\",\"index.md\":\"DyWncAhB\",\"docs_security-strategy_common-attack-and-protection-methods.md\":\"BqJh5obh\",\"docs_authentication-strategy_authorization.md\":\"Bmm18NQS\",\"docs_security-strategy_same-origin-policy.md\":\"1F3LK5dv\",\"docs_other_mime-type.md\":\"CKW4tbzk\",\"docs_content-negotiation_condition-request.md\":\"oPYlbkb6\",\"docs_overview_the-history-of-http.md\":\"COFluZLg\",\"docs_content-negotiation_content-negotiation.md\":\"D_8duoEU\",\"docs_content-negotiation_client-hints.md\":\"Y3O76zFD\",\"docs_introduc_introduc.md\":\"DjsU6Hms\",\"docs_performance-optimization-strategy_http-cache.md\":\"BCc7O8ko\",\"docs_performance-optimization-strategy_data-compression.md\":\"DGkahwJ4\",\"docs_overview_http-message-format.md\":\"DkiTFqd7\",\"docs_security-strategy_rescue-insecure-http-https.md\":\"CRPcvfFF\",\"docs_security-strategy_content-security-policy.md\":\"DuJIYtMm\",\"docs_performance-optimization-strategy_long-connection-and-short-connection.md\":\"BrxQ14Fo\",\"docs_other_url.md\":\"DSV8y4zY\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"zh-CN\",\"dir\":\"ltr\",\"title\":\"HTTP完全注释\",\"description\":\"HTTP完全注释\",\"base\":\"/HTTP-Explanation/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"siteTitle\":\"HTTP完全注释\",\"lastUpdatedText\":\"最后更新\",\"darkModeSwitchLabel\":\"切换模式\",\"sidebarMenuLabel\":\"菜单\",\"docFooter\":{\"prev\":\"上一页\",\"next\":\"下一页\"},\"outline\":\"deep\",\"returnToTopLabel\":\"返回顶部\",\"langMenuLabel\":\"切换语言\",\"outlineTitle\":\"目录\",\"footer\":{\"message\":\"请勿将本站文章用作商业用途 | 转载请标明来源\",\"copyright\":\"Copyright © 2023-present JunLiangWang\"},\"editLink\":{\"text\":\"在Github编辑此页\",\"pattern\":\"https://github.com/JunLiangWangX/HTTP-Explanation/edit/main/src/:path\"},\"nav\":[{\"text\":\"支持作者\",\"link\":\"https://wangjunliang.com/#/supportBloggers\"},{\"text\":\"了解作者\",\"link\":\"https://wangjunliang.com/\"}],\"sidebar\":[{\"text\":\"前言\",\"items\":[{\"text\":\"这是一份最强HTTP指南\",\"link\":\"/docs/introduc/introduc\"}]},{\"text\":\"概述\",\"items\":[{\"text\":\"HTTP的历史\",\"link\":\"/docs/overview/the-history-of-http\"},{\"text\":\"HTTP的报文格式\",\"link\":\"/docs/overview/http-message-format\"}]},{\"text\":\"安全策略\",\"items\":[{\"text\":\"拯救不安全的HTTP - HTTPS\",\"link\":\"/docs/security-strategy/rescue-insecure-http-https\"},{\"text\":\"XSS攻击？内容安全策略会出手的\",\"link\":\"/docs/security-strategy/content-security-policy\"},{\"text\":\"CSRF攻击？同源策略会出手的\",\"link\":\"/docs/security-strategy/same-origin-policy\"},{\"text\":\"又跨域了？一文解释清楚跨源资源共享（cors）\",\"link\":\"/docs/security-strategy/cross-origin-resource-sharing\"},{\"text\":\"常见攻击与防护\",\"link\":\"/docs/security-strategy/common-attack-and-protection-methods\"}]},{\"text\":\"身份认证策略\",\"items\":[{\"text\":\"Cookie\",\"link\":\"/docs/authentication-strategy/cookie\"},{\"text\":\"Authorization\",\"link\":\"/docs/authentication-strategy/authorization\"}]},{\"text\":\"性能优化策略\",\"items\":[{\"text\":\"长连接与短连接\",\"link\":\"/docs/performance-optimization-strategy/long-connection-and-short-connection\"},{\"text\":\"HTTP缓存\",\"link\":\"/docs/performance-optimization-strategy/http-cache\"},{\"text\":\"数据压缩\",\"link\":\"/docs/performance-optimization-strategy/data-compression\"}]},{\"text\":\"内容协商策略\",\"items\":[{\"text\":\"范围请求\",\"link\":\"/docs/content-negotiation/range-request\"},{\"text\":\"条件请求\",\"link\":\"/docs/content-negotiation/condition-request\"},{\"text\":\"内容协商\",\"link\":\"/docs/content-negotiation/content-negotiation\"},{\"text\":\"客户端提示\",\"link\":\"/docs/content-negotiation/client-hints\"}]},{\"text\":\"其他\",\"items\":[{\"text\":\"MIME类型\",\"link\":\"/docs/other/mime-type\"},{\"text\":\"URL\",\"link\":\"/docs/other/url\"}]}],\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/JunLiangWangX/HTTP-Explanation/\"}]},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>