import{_ as s,c as a,o as i,U as e}from"./chunks/framework.gK-zsNwe.js";const t="/HTTP-Explanation/assets/range-request-example.1Xkfy1vb.png",n="/HTTP-Explanation/assets/range-request-wanzheng.0N9983zX.png",p="/HTTP-Explanation/assets/if-range-last-modified-header-example.9Lt6XXNu.png",l="/HTTP-Explanation/assets/if-range-header-example.cmy06oIO.png",F=JSON.parse('{"title":"范围请求","description":"","frontmatter":{},"headers":[],"relativePath":"docs/content-negotiation/range-request.md","filePath":"docs/content-negotiation/range-request.md","lastUpdated":1704556360000}'),h={name:"docs/content-negotiation/range-request.md"},o=e('<h1 id="范围请求" tabindex="-1">范围请求 <a class="header-anchor" href="#范围请求" aria-label="Permalink to &quot;范围请求&quot;">​</a></h1><p><strong>范围请求是HTTP的一种内容协商机制，该机制允许客户端只请求资源的部分内容</strong>。范围请求在传送大的媒体文件，或者与文件下载的断点续传功能搭配使用时非常有用。</p><h2 id="范围请求的工作流程" tabindex="-1">范围请求的工作流程 <a class="header-anchor" href="#范围请求的工作流程" aria-label="Permalink to &quot;范围请求的工作流程&quot;">​</a></h2><p>范围请求通过在HTTP请求标头<code>Range</code>中表明需要请求的部分资源的字节范围，服务器收到请求后将判断<code>Range</code>指定的范围是否超出资源的大小。如果范围未超出资源大小，服务器将响应 <code>206 Partial Content</code> 状态码，以及<code>Range</code>标头指定的资源的部分内容，并携带<code>Content-Range</code>响应头表明返回部分资源的字节范围/整体资源大小；如果所请求的范围越界，那么服务器会返回 <code>416 Requested Range Not Satisfiable</code> （请求的范围无法满足）状态码，表示客户端错误。如果事先不知资源能否范围请求，还需要事先发送一个<code>head</code>请求进行检测。</p><p><img src="'+t+`" alt="range-request-example"></p><p>范围请求工作流程如下：</p><ul><li><p><strong>未知资源能否发起范围请求（已知忽略该步）</strong>：对请求资源发起一个head请求，检测能否使用范围请求。</p></li><li><p><strong>服务端响应head请求（已知忽略该步）</strong>：服务端收到head请求后，只会返回响应头部信息，而不返回实际的资源内容。<strong>如果返回头部信息中有包含<code>Accept-Ranges: bytes</code>头，则证明该资源支持范围请求，同时还会包含一个<code>Content-Length</code>头，该头表明了资源的整体大小；如果未包含<code>Accept-Ranges: bytes</code>则表明不支持范围请求</strong>。</p></li><li><p><strong>客户端发起范围请求</strong>：客户端携带<code>Range</code>请求标头，表明需要请求的部分资源的字节范围。<strong>客户端不仅仅只能指定请求资源的某一部分（单一范围），还可以指定请求资源的多个部分（多重范围）</strong>。</p><blockquote><p>单一范围请求/示例</p></blockquote><div class="language-http vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">http</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">GET</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /image.png </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">HTTP</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Range</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bytes=0-1023</span></span></code></pre></div><blockquote><p>多重范围请求示例</p></blockquote><div class="language-http vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">http</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">GET</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /image.png </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">HTTP</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Range</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bytes=0-1023, 2000-6576</span></span></code></pre></div></li><li><p><strong>服务端响应范围请求</strong>：服务端收到范围请求后，将判断请求资源是否存在<code>Range</code>中指定的字节范围，如果存在，服务端将正确处理请求，并只返回该范围内的数据，携带<code>Content-Range</code>响应头表明返回部分资源的字节范围/整体资源大小，携带<code>Content-Length</code>响应头表示响应的响应体的大小，使用<code>206 Partial Content</code> 状态码来指示成功响应请求的部分内容。如果所请求的范围越界，那么服务器会返回 <code>416 Requested Range Not Satisfiable</code> （请求的范围无法满足）状态码，表示客户端错误。</p><blockquote><p>单一范围请求响应示例</p></blockquote><div class="language-http vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">http</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HTTP/1.1 206 Partial Content</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Content-Range</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bytes 0-1023/146515</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Content-Length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 1024</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(binary content)</span></span></code></pre></div><blockquote><p>多重范围请求响应示例</p></blockquote><div class="language-http vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">http</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HTTP/1.1 206 Partial Content</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Content-Type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> multipart/byteranges; boundary=3d6b6a416f9b5</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Content-Length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 2082</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--3d6b6a416f9b5</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Content-Type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> image/png</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Content-Range</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bytes 0-1000/146515</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(binary content)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--3d6b6a416f9b5</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Content-Type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> image/png</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Content-Range</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bytes 2000-3000/146515</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(binary content)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--3d6b6a416f9b5</span></span></code></pre></div><div class="danger custom-block"><p class="custom-block-title">上述多重范围请求响应示例中，请求的资源范围总共为2000bytes，为什么<code>Content-Length</code>却为2082bytes?</p><p><code>Content-Length</code>这个值不仅仅包括消息体的实际数据（即两个<code>image/png</code>部分），还包括了<code>multipart</code>格式的边界、每个部分的头部和可能的空行等。其次，每个部分（在这里是两个<code>image/png</code>部分）都有自己的<code>Content-Type</code>和<code>Content-Range</code>头部，这些头部的大小也要计入<code>Content-Length</code>中。</p></div><p>与范围请求相关的三种响应状态：</p><ul><li>在请求成功的情况下，服务器会返回 <code>206 Partial Content</code> 状态码。</li><li>在请求的范围越界的情况下（范围值超过了资源的大小），服务器会返回 <code>416 Requested Range Not Satisfiable</code> （请求的范围无法满足）状态码。</li><li>在不支持范围请求的情况下，服务器会返回 <code>200 OK</code> 状态码。</li></ul></li></ul><h2 id="保障资源完整性" tabindex="-1">保障资源完整性 <a class="header-anchor" href="#保障资源完整性" aria-label="Permalink to &quot;保障资源完整性&quot;">​</a></h2><p>范围请求每次都只请求资源的部分内容，那么如何保障两次请求的资源未发生过更改呢？如何保障资源的完整性呢？比如我使用范围请求请求了资源的一半内容，过了两天之后，我又继续使用范围请求请求资源的另一半内容，此时我是无法确认我请求的另一半资源未发生过更改，且无法保障两份资源能够拼合在一起还原为一份完整资源。</p><p><img src="`+n+'" alt="range-request-wanzheng"></p><p>为解决该问题，HTTP协议规定了一个特定的请求头 <code>If-Range</code>——来避免这种情况的发生。使用<code>If-Range</code>请求头与<code>Etag</code>响应头搭配使用，即可对请求资源进行版本验证；使用<code>If-Range</code>请求头与<code>Last-Modified</code>响应头搭配使用，即可对请求资源进行时间验证。</p><h4 id="基于时间的验证——last-modified-if-range" tabindex="-1">基于时间的验证——Last-Modified/If-Range <a class="header-anchor" href="#基于时间的验证——last-modified-if-range" aria-label="Permalink to &quot;基于时间的验证——Last-Modified/If-Range&quot;">​</a></h4><p><img src="'+p+`" alt="if-range-last-modified-header-example"></p><p>当客户端首次发起范围请求请求资源部分内容时，<strong>服务器的响应会携带<code>Last-Modified</code>响应标头来表明请求资源最后被修改的时间，通常情况下，服务器会根据文件系统中资源的最后修改时间自动设置这个标头。</strong> 如下所示：</p><div class="language-http vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">http</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HTTP/1.1 206 Partial Content</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Content-Range</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bytes 0-1023/146515</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Content-Length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 1024</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Last-Modified</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Tue, 22 Feb 2022 22:00:00 GMT</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">........</span></span></code></pre></div><p><strong>客户端收到响应后需要自行将这个时间存储起来，后续客户端再次对该资源进行范围请求时，需要自行携带一个<code>If-Range</code>请求头，并将保存的时间值放入其中，以告诉浏览器，上一次范围请求请求的资源最后被修改的时间</strong>，如下所示：</p><div class="language-http vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">http</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">GET</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /image.png </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">HTTP</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Range</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bytes=1024-2047</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">If-Range</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Tue, 22 Feb 2022 22:00:00 GMT</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">......</span></span></code></pre></div><p><strong>服务器收到该请求后会比较请求中的 <code>If-Range</code> 值与当前资源的最后修改时间，如果内容自指定时间以来没有更改，则证明资源未发生更改，此时浏览器会返回状态码为<code>206 Partial</code> 的响应，以及相应的部分资源；如果请求资源发生了更改，那么就会返回状态码为 <code>200 OK</code> 的响应，同时返回整个资源。</strong></p><blockquote><p><code>If-Range</code>值与当前资源的最后修改时间相同的响应</p></blockquote><div class="language-HTTP vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">HTTP</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HTTP/1.1 206 Partial Content</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Content-Range</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bytes 1024-2047/146515</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Content-Length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 1024</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Last-Modified</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Tue, 22 Feb 2022 22:00:00 GMT</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">........</span></span></code></pre></div><blockquote><p><code>If-Range</code>值与当前资源的最后修改时间不同的响应</p></blockquote><div class="language-http vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">http</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HTTP/1.1 200 ok</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Last-Modified</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Tue, 23 Feb 2022 22:00:00 GMT</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Content-Length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 146515</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.................</span></span></code></pre></div><p>基于时间的验证虽然保证了资源的一致性与完整性问题，但它也存在诸多问题：</p><ul><li><strong>时间精度问题：</strong> 时间戳通常只有秒级别的精度，这可能导致在某些情况下无法检测到资源的真正修改。如果两次修改之间的时间间隔很短，可能无法捕捉到变化。</li><li><strong>服务器时钟回退：</strong> 如果服务器的时钟回退（例如，由于时钟同步服务的干预），可能会导致客户端认为资源已经过期，尽管实际上它仍然是最新的。</li><li><strong>资源未被修改但最后修改时间已变：</strong> 有时资源的内容并没有实际修改，但由于某些原因，最后修改时间被更新了。这可能导致不必要的资源传输。</li></ul><p>为了解决这些问题，HTTP缓存推出了基于版本的验证作为替代方案。</p><h4 id="基于版本的验证——etag-if-range" tabindex="-1">基于版本的验证——ETag/If-Range <a class="header-anchor" href="#基于版本的验证——etag-if-range" aria-label="Permalink to &quot;基于版本的验证——ETag/If-Range&quot;">​</a></h4><p><img src="`+l+`" alt="if-range-header-example"></p><p>当客户端首次发起范围请求请求资源部分内容时，<strong>服务器的响应会携带<code>ETag</code>响应标头来表明请求资源的版本</strong>，该标头的值是服务器生成的任意值，因此服务器可以根据他们选择的任何方式自由设置值——例如主体内容的哈希或版本号，如下所示：</p><div class="language-http vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">http</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HTTP/1.1 206 Partial Content</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Content-Range</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bytes 0-1023/146515</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Content-Length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 1024</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">ETag</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;deadbeef&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">........</span></span></code></pre></div><p><strong>客户端收到响应后需要自行将<code>ETag</code>的值存储起来，后续客户端再次对该资源进行范围请求时，需要自行携带一个<code>If-Range</code>请求头，并将保存的<code>ETag</code>值放入其中，以告诉浏览器，上一次范围请求请求的资源的版本</strong>，如下所示：</p><div class="language-http vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">http</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">GET</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /image.png </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">HTTP</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Range</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bytes=1024-2047</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">If-Range</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;deadbeef&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">......</span></span></code></pre></div><p><strong>服务器收到该请求后会比较请求中的 <code>If-Range</code> 值与当前资源版本号是否相同，如果当前资源版本号与请求中的<code>If-Range</code> 值相同，则证明资源未发生更改，此时浏览器会返回状态码为<code>206 Partial</code> 的响应，以及相应的部分资源；如果当前资源版本号与请求中的<code>If-Range</code> 值不同，那么就会返回状态码为 <code>200 OK</code> 的响应，同时返回整个资源。</strong></p><blockquote><p><code>If-Range</code>值与当前资源版本相同的响应</p></blockquote><div class="language-HTTP vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">HTTP</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HTTP/1.1 206 Partial Content</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Content-Range</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bytes 1024-2047/146515</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Content-Length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 1024</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">ETag</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;deadbeef&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">........</span></span></code></pre></div><blockquote><p><code>If-Range</code>值与当前资源版本不同的响应</p></blockquote><div class="language-http vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">http</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HTTP/1.1 200 ok</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">ETag</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;sdaeadbeef&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Content-Length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 146515</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.................</span></span></code></pre></div><div class="danger custom-block"><p class="custom-block-title"><code>If-Range</code>不能与<code>Last-Modified</code>、<code>ETag</code>同时使用</p><p><code>If-Range</code>请求标头可以与<code>Last-Modified</code>响应标头搭配组成基于时间的验证，也可以与<code>ETag</code>响应标头搭配组成基于版本的验证，但不能同时与<code>Last-Modified</code>、<code>ETag</code>同时使用。</p></div><h2 id="相关标头" tabindex="-1">相关标头 <a class="header-anchor" href="#相关标头" aria-label="Permalink to &quot;相关标头&quot;">​</a></h2><h3 id="accept-ranges-响应标头" tabindex="-1">Accept-Ranges <code>响应标头</code> <a class="header-anchor" href="#accept-ranges-响应标头" aria-label="Permalink to &quot;Accept-Ranges \`响应标头\`&quot;">​</a></h3><p><strong>响应标头<code>Accept-Ranges</code>表示请求资源是否支持范围请求</strong>。当浏览器发现<code>Accept-Ranges</code>头时，可以尝试<em>继续</em>中断了的下载，而不是重新开始。</p><p><strong>参数</strong></p><p>该响应标头并无其他参数</p><p><strong>取值</strong></p><ul><li><p><strong>none</strong></p><p>表示不支持任何范围请求，由于其等同于没有返回此头部，因此很少使用。</p></li><li><p><strong>bytes</strong></p><p>表示支持范围请求，其范围单位为bytes(字节)</p></li></ul><p><strong>示例</strong></p><div class="language-http vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">http</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Accept-Ranges</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bytes</span></span></code></pre></div><h3 id="content-length-实体标头" tabindex="-1">Content-Length <code>实体标头</code> <a class="header-anchor" href="#content-length-实体标头" aria-label="Permalink to &quot;Content-Length \`实体标头\`&quot;">​</a></h3><p><strong>实体标头<code>Content-Length</code>表示消息主体的大小，用来指明发送给接收方的消息主体的大小，单位为bytes(字节)</strong>。</p><p><strong>参数</strong></p><p>该实体标头并无其他参数</p><p><strong>取值</strong></p><ul><li><p><strong>&lt;length&gt;</strong></p><p>十进制数字，表明消息体的长度，单位为bytes(字节)。</p></li></ul><p><strong>示例</strong></p><div class="language-http vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">http</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Content-Length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">1024</span></span></code></pre></div><h3 id="range-请求标头" tabindex="-1">Range <code>请求标头</code> <a class="header-anchor" href="#range-请求标头" aria-label="Permalink to &quot;Range \`请求标头\`&quot;">​</a></h3><p><strong>请求标头<code>Range</code>指定了一系列的字节范围，用于告知服务器客户端需要请求资源哪些部分的内容</strong>。如果范围未超出资源大小，服务器将响应 <code>206 Partial Content</code> 状态码，以及<code>Range</code> 头字段请求的相应部分，如果所请求的范围不合法，那么服务器会返回 <code>416 Range Not Satisfiable</code> 状态码，表示客户端错误。</p><p><strong>参数</strong></p><p>该请求标头并无其他参数</p><p><strong>取值</strong></p><ul><li><p><strong>&lt;unit&gt;=[&lt;star-end&gt;,&lt;start-&gt;......]</strong></p><p><strong>&lt;unit&gt;：</strong> 范围所采用的单位，通常是字节（bytes）。</p><p><strong>start：</strong> 一个整数，表示范围的起始值。</p><p><strong>end：</strong> 一个整数，表示范围的结束值，如果不存在，表示此范围一直延伸到文档结束。</p></li></ul><p><strong>示例</strong></p><div class="language-http vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">http</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Range</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bytes=200-1000, 2000-6576, 19000-</span></span></code></pre></div><h3 id="content-range-实体标头" tabindex="-1">Content-Range <code>实体标头</code> <a class="header-anchor" href="#content-range-实体标头" aria-label="Permalink to &quot;Content-Range \`实体标头\`&quot;">​</a></h3><p>实体标头<code>Content-Range</code>表示响应的部分资源的字节范围，以及资源的整体大小。</p><p><strong>参数</strong></p><p>该实体标头并无其他参数</p><p><strong>取值</strong></p><ul><li><p><strong>&lt;unit&gt; &lt;star-end&gt;/&lt;size&gt;</strong></p><p><strong>unit：</strong> 范围所采用的单位，通常是字节（bytes）。</p><p><strong>start：</strong> 一个整数，表示范围的起始值。</p><p><strong>end：</strong> 一个整数，表示范围的结束值。</p><p><strong>size：</strong> 资源的整体大小。</p></li></ul><p><strong>示例</strong></p><div class="language-http vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">http</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Content-Range</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bytes 200-1000/67589</span></span></code></pre></div><h3 id="if-range-请求标头" tabindex="-1">If-Range <code>请求标头</code> <a class="header-anchor" href="#if-range-请求标头" aria-label="Permalink to &quot;If-Range \`请求标头\`&quot;">​</a></h3><p><strong>请求标头<code>If-Range</code>当与<code>Last-Modified</code>响应标头搭配时，需要指定一个绝对时间，通过检查资源的最后修改时间是否更改，来检查资源是否发生变化；当与<code>Etag</code>响应标头搭配时，需要指定一个版本号，通过检查资源是否与给定版本号匹配，来检查资源是否发生更改</strong>。</p><p>当资源未发生更改服务器才会回复<code>206 Partial Content</code>状态码，以及<code>Range</code> 头字段请求的相应部分；如果资源发生更改，服务器将会返回 <code>200 OK</code> 状态码，并返回完整的请求资源。</p><p><strong>参数</strong></p><p>该请求标头并无其他参数。</p><p><strong>取值</strong></p><ul><li><p><strong>&lt;date&gt;</strong></p><p>指定一个绝对时间，表示希望服务器检查资源的最后修改时间是否更改，也就是检查资源是否发生变化。</p></li><li><p><strong>&quot;&lt;etag_value&gt;&quot;</strong></p><p>指定一个版本号，表示希望服务器检查资源是否与给定版本号匹配，也就是检查资源是否发生变化。</p></li></ul><p><strong>示例</strong></p><div class="language-http vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">http</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">If-Range</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Wed, 21 Oct 2015 07:28:00 GMT</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">If-Range</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;deadbeef&quot;</span></span></code></pre></div><h3 id="last-modified-响应标头" tabindex="-1">Last-Modified <code>响应标头</code> <a class="header-anchor" href="#last-modified-响应标头" aria-label="Permalink to &quot;Last-Modified \`响应标头\`&quot;">​</a></h3><p><strong>响应标头<code>Last-Modified</code>指定了响应的资源最后被修改的时间，通常情况下，服务器会根据文件系统中资源的最后修改时间自动设置这个标头。</strong></p><p><strong>参数</strong></p><p>该响应标头并无其他参数。</p><p><strong>取值</strong></p><ul><li><p><strong>&lt;date&gt;</strong></p><p>一个绝对时间，指定响应的资源最后被修改的时间。</p></li></ul><p><strong>示例</strong></p><div class="language-http vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">http</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">Last-Modified</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Wed, 21 Oct 2015 07:28:00 GMT</span></span></code></pre></div><h3 id="etag-响应标头" tabindex="-1">ETag <code>响应标头</code> <a class="header-anchor" href="#etag-响应标头" aria-label="Permalink to &quot;ETag \`响应标头\`&quot;">​</a></h3><p><strong>响应标头<code>ETag</code>指定了一个版本号，表明响应的资源的版本</strong>，该标头的值是服务器生成的任意值，因此服务器可以根据他们选择的任何方式自由设置值——例如主体内容的哈希或版本号。</p><p><strong>参数</strong></p><ul><li><p><strong>W/</strong> <code>可选</code></p><p><code>&#39;W/&#39;</code>(大小写敏感) 表示使用<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Conditional_requests#weak_validation" target="_blank" rel="noreferrer">弱验证器</a>。弱验证器很容易生成，但不利于比较。强验证器是比较的理想选择，但很难有效地生成。相同资源的两个弱<code>Etag</code>值可能语义等同，但不是每个字节都相同。</p></li><li><p><strong>&quot;&lt;etag_value&gt;&quot;</strong></p><p>指定一个版本号，没有明确指定生成 ETag 值的方法。通常，使用内容的散列，最后修改时间戳的哈希值，或简单地使用版本号。例如，MDN 使用 wiki 内容的十六进制数字的哈希值。</p></li></ul><p><strong>示例</strong></p><div class="language-http vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">http</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">ETag</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;33a64df551425fcc55e4d42a148795d9f25f89d4&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">ETag</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> W/&quot;0815&quot;</span></span></code></pre></div><h2 id="本节参考" tabindex="-1">本节参考 <a class="header-anchor" href="#本节参考" aria-label="Permalink to &quot;本节参考&quot;">​</a></h2><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Range_requests" target="_blank" rel="noreferrer">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Range_requests</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Accept-Ranges" target="_blank" rel="noreferrer">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Accept-Ranges</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Range" target="_blank" rel="noreferrer">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Range</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Range" target="_blank" rel="noreferrer">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Range</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Last-Modified" target="_blank" rel="noreferrer">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Last-Modified</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/ETag" target="_blank" rel="noreferrer">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/ETag</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/If-Range" target="_blank" rel="noreferrer">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/If-Range</a></li></ul><p>转载需要经过本人同意，并标明出处！</p>`,96),d=[o];function g(r,k,c,E,y,u){return i(),a("div",null,d)}const C=s(h,[["render",g]]);export{F as __pageData,C as default};
